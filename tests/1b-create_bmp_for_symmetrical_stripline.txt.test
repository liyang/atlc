# !/bin/sh
# This test runs atlc, but if the package was configured with the --with-mpi
# or --with-mpe options, then atlc should not be called directly, but via
# the mpirun script, which is part of the MPICH distribution. 

if [ -n "$mpirun_found" ] ; then
  Zo=`mpirun -np 2 $top_builddir/src/non_gui/atlc $top_builddir/tmp/test_sym_strip.bmp | awk '{print $6}'` 2> /dev/null
else
  Zo=`$top_builddir/src/non_gui/atlc $top_builddir/tmp/test_sym_strip.bmp | awk '{print $6}'`
fi

# No matter how atlc was configuerd, in an ideal world the results
# should be the same, so we just check the results. In practice, in
# version 4.2.12 of the software, the MPICH libraries are not working
# properly and so atlc is likely to either fail completely, or to give
# slightly different answers to those expected for the single built_with_posix_threads
# case. 
if [ -z "$Zo" ] ; then
  exit 1  
fi

# Check the impedance Zo which should be 122.44 Ohms
if [ $Zo = 122.44 ] ; then
  echo "PASSED:" $0 >> tests.log
  exit 0
else
  echo "FAILED:" $0 >> tests.log
  exit 1
fi
